<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;600;700&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:#f4f6fb;--white:#ffffff;--accent:#1e3a5f;--accent2:#2d5a8e;
    --teal:#1a7a8a;--muted:#6070a0;--border:#dce4f4;
    --red:#b03030;--shadow2:0 4px 32px rgba(30,58,95,0.16);
  }
  *{box-sizing:border-box;margin:0;padding:0;}
  body{background:var(--bg);font-family:'Raleway',sans-serif;display:flex;flex-direction:column;align-items:center;padding:28px 12px 20px;}
  .container{width:100%;max-width:760px;}
  header{text-align:center;margin-bottom:22px;}
  .header-inner{display:inline-block;background:var(--white);border-radius:6px;padding:16px 36px 14px;box-shadow:var(--shadow2);border-top:4px solid var(--accent);}
  h1{font-size:22px;font-weight:700;color:var(--accent);letter-spacing:4px;text-transform:uppercase;margin-bottom:4px;}
  .subtitle{font-family:'Lora',serif;font-style:italic;color:var(--muted);font-size:13px;letter-spacing:1px;}
  #current-date{color:var(--muted);font-size:11px;margin-top:5px;letter-spacing:0.5px;}
  .accent-bar{width:40px;height:3px;background:linear-gradient(90deg,var(--accent),var(--teal));border-radius:2px;margin:8px auto 0;}
  .engine-badge{display:inline-flex;align-items:center;gap:5px;margin-top:8px;background:#eef4ff;border:1px solid #c0d0e8;border-radius:20px;padding:3px 10px;font-size:10px;font-weight:600;color:var(--accent);letter-spacing:1px;}
  .engine-badge .dot{width:6px;height:6px;background:#27ae60;border-radius:50%;animation:pulse 2s ease-in-out infinite;}
  @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}
  .content-grid{display:grid;grid-template-columns:1fr 1fr;gap:18px;align-items:start;}
  @media(max-width:560px){.content-grid{grid-template-columns:1fr;}.header-inner{padding:14px 20px 12px;}}
  .card{background:var(--white);border-radius:6px;box-shadow:var(--shadow2);overflow:hidden;}
  .card-header{background:linear-gradient(135deg,var(--accent) 0%,var(--accent2) 100%);padding:11px 16px;display:flex;align-items:center;gap:8px;}
  .card-header-icon{font-size:15px;color:#fff;opacity:0.85;}
  .card-title{font-size:10px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:rgba(255,255,255,0.92);}
  .card-body{padding:16px;}
  .wheel-card .card-body{display:flex;justify-content:center;padding:18px;background:radial-gradient(ellipse at center,#eef2fb 0%,#f8faff 100%);}
  #horoscope-wheel{width:100%;max-width:260px;height:auto;filter:drop-shadow(0 2px 8px rgba(30,58,95,0.12));}
  .planet-row{display:flex;align-items:center;gap:7px;padding:7px 4px;border-bottom:1px solid var(--border);border-radius:3px;transition:background 0.15s;animation:fadeIn 0.35s ease both;}
  .planet-row:hover{background:#f4f7ff;}
  .planet-row:last-child{border-bottom:none;}
  @keyframes fadeIn{from{opacity:0;transform:translateX(-4px)}to{opacity:1;transform:translateX(0)}}
  .planet-symbol{font-size:17px;width:22px;text-align:center;flex-shrink:0;}
  .planet-name{font-size:10px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--accent);width:56px;flex-shrink:0;}
  .planet-position{flex:1;display:flex;align-items:center;gap:4px;min-width:0;}
  .sign-symbol{font-size:13px;flex-shrink:0;}
  .sign-name{font-family:'Lora',serif;font-size:13px;font-style:italic;color:var(--teal);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
  .retrograde{color:var(--red);font-size:9px;font-weight:700;letter-spacing:1px;background:#fdecea;padding:1px 4px;border-radius:3px;flex-shrink:0;}
  .degrees{margin-left:auto;font-size:11px;font-weight:600;color:var(--white);background:linear-gradient(135deg,var(--accent) 0%,var(--accent2) 100%);padding:2px 7px;border-radius:10px;flex-shrink:0;letter-spacing:0.3px;}
  .status{text-align:center;padding:28px;color:var(--muted);font-family:'Lora',serif;font-style:italic;font-size:14px;}
  .status.error{color:var(--red);background:#fff8f8;border-radius:6px;border:1px solid #fdd;}
  footer{text-align:center;margin-top:14px;font-size:11px;color:var(--muted);opacity:0.7;}
</style>
</head>
<body>
<div class="container">
  <header>
    <div class="header-inner">
      <h1>Niebo Teraz</h1>
      <div class="subtitle">Aktualne Pozycje Planet</div>
      <div id="current-date"></div>
      <div class="accent-bar"></div>
      <div class="engine-badge"><span class="dot"></span>Swiss Ephemeris</div>
    </div>
  </header>

  <div class="content-grid">
    <div class="card wheel-card">
      <div class="card-header"><span class="card-header-icon">◯</span><span class="card-title">Koło Zodiaku</span></div>
      <div class="card-body"><svg id="horoscope-wheel" viewBox="0 0 300 300" xmlns="http://www.w3.org/2000/svg"></svg></div>
    </div>
    <div class="card">
      <div class="card-header"><span class="card-header-icon">♃</span><span class="card-title">Pozycje Planet</span></div>
      <div class="card-body"><div id="planet-list"><div class="status">Ładowanie Swiss Ephemeris…</div></div></div>
    </div>
  </div>

  <footer>Swiss Ephemeris (Astrodienst AG) · Czas UTC · astrologiaewolucyjna.com</footer>
</div>

<script type="module">
// ── Swiss Ephemeris WebAssembly — same engine as SolarFire, Astro.com ──────
import SwissEph from 'https://cdn.jsdelivr.net/gh/prolaxu/swisseph-wasm@main/src/swisseph.js';

const DEG = Math.PI / 180;

const SIGNS = [
  {name:'Baran',      symbol:'♈', color:'#c0392b'},
  {name:'Byk',        symbol:'♉', color:'#27ae60'},
  {name:'Bliźnięta',  symbol:'♊', color:'#c8961a'},
  {name:'Rak',        symbol:'♋', color:'#2980b9'},
  {name:'Lew',        symbol:'♌', color:'#d35400'},
  {name:'Panna',      symbol:'♍', color:'#16a085'},
  {name:'Waga',       symbol:'♎', color:'#8e44ad'},
  {name:'Skorpion',   symbol:'♏', color:'#922b21'},
  {name:'Strzelec',   symbol:'♐', color:'#ca6f1e'},
  {name:'Koziorożec', symbol:'♑', color:'#566573'},
  {name:'Wodnik',     symbol:'♒', color:'#1a5276'},
  {name:'Ryby',       symbol:'♓', color:'#6c3483'},
];

// Planet IDs in Swiss Ephemeris
const PLANETS = [
  {name:'Słońce',  symbol:'☉', color:'#c47c0a', id: 0},   // SE_SUN
  {name:'Księżyc', symbol:'☽', color:'#2471a3', id: 1},   // SE_MOON
  {name:'Merkury', symbol:'☿', color:'#707b8a', id: 2},   // SE_MERCURY
  {name:'Wenus',   symbol:'♀', color:'#1e8449', id: 3},   // SE_VENUS
  {name:'Mars',    symbol:'♂', color:'#c0392b', id: 4},   // SE_MARS
  {name:'Jowisz',  symbol:'♃', color:'#9a6b00', id: 5},   // SE_JUPITER
  {name:'Saturn',  symbol:'♄', color:'#7d6608', id: 6},   // SE_SATURN
  {name:'Uran',    symbol:'⛢', color:'#0e7490', id: 7},   // SE_URANUS
  {name:'Neptun',  symbol:'♆', color:'#1a3a7e', id: 8},   // SE_NEPTUNE
  {name:'Pluton',  symbol:'♇', color:'#6d4c41', id: 9},   // SE_PLUTO
];

function getSign(lon) {
  const idx = Math.floor(lon / 30);
  const d   = lon % 30;
  const deg = Math.floor(d);
  const min = Math.floor((d - deg) * 60);
  return { ...SIGNS[idx], deg, min };
}

// ── DRAW WHEEL ─────────────────────────────────────────────────────────────
function drawWheel(data) {
  const svg = document.getElementById('horoscope-wheel');
  const cx=150, cy=150, rO=138, rB=116, rI=95, rP=74;
  svg.innerHTML = '';
  const ns = 'http://www.w3.org/2000/svg';
  const el = (tag, attrs, txt) => {
    const e = document.createElementNS(ns, tag);
    for (const [k,v] of Object.entries(attrs)) e.setAttribute(k, v);
    if (txt !== undefined) e.textContent = txt;
    return e;
  };

  const defs = el('defs', {});
  const g = el('radialGradient', {id:'bg', cx:'50%', cy:'50%', r:'50%'});
  g.appendChild(el('stop', {offset:'0%', 'stop-color':'#eef2fb'}));
  g.appendChild(el('stop', {offset:'100%', 'stop-color':'#dde4f5'}));
  defs.appendChild(g); svg.appendChild(defs);

  svg.appendChild(el('circle', {cx, cy, r:rO, fill:'url(#bg)', stroke:'#b0bcd8', 'stroke-width':'1.5'}));

  for (let i = 0; i < 12; i++) {
    const a1=(i*30-90)*DEG, a2=((i+1)*30-90)*DEG;
    const x1=cx+rB*Math.cos(a1), y1=cy+rB*Math.sin(a1);
    const x2=cx+rO*Math.cos(a1), y2=cy+rO*Math.sin(a1);
    const x3=cx+rO*Math.cos(a2), y3=cy+rO*Math.sin(a2);
    const x4=cx+rB*Math.cos(a2), y4=cy+rB*Math.sin(a2);
    svg.appendChild(el('path', {
      d:`M ${x1} ${y1} L ${x2} ${y2} A ${rO} ${rO} 0 0 1 ${x3} ${y3} L ${x4} ${y4} A ${rB} ${rB} 0 0 0 ${x1} ${y1}`,
      fill:SIGNS[i].color+'22', stroke:'#b8c4dc', 'stroke-width':'0.5'
    }));
    const ma=((i+0.5)*30-90)*DEG, rs=(rB+rO)/2;
    svg.appendChild(el('text', {
      x:cx+rs*Math.cos(ma), y:cy+rs*Math.sin(ma),
      'text-anchor':'middle', 'dominant-baseline':'central',
      fill:SIGNS[i].color, 'font-size':'13', 'font-weight':'bold'
    }, SIGNS[i].symbol));
  }

  svg.appendChild(el('circle', {cx, cy, r:rB, fill:'none', stroke:'#a8b8d8', 'stroke-width':'1.2'}));
  svg.appendChild(el('circle', {cx, cy, r:rI, fill:'#f0f4fc', stroke:'#b8c8e0', 'stroke-width':'1'}));

  for (let i = 0; i < 360; i += 5) {
    const a=(i-90)*DEG, r1=i%30===0?rI-12:i%10===0?rI-7:rI-3;
    svg.appendChild(el('line', {
      x1:cx+rI*Math.cos(a), y1:cy+rI*Math.sin(a), x2:cx+r1*Math.cos(a), y2:cy+r1*Math.sin(a),
      stroke:i%30===0?'#6070a0':'#b0bcd8', 'stroke-width':i%30===0?'1.2':'0.6'
    }));
  }
  for (let i = 0; i < 12; i++) {
    const a=(i*30-90)*DEG;
    svg.appendChild(el('line', {
      x1:cx+rI*Math.cos(a), y1:cy+rI*Math.sin(a), x2:cx+rB*Math.cos(a), y2:cy+rB*Math.sin(a),
      stroke:'#8898c0', 'stroke-width':'0.8'
    }));
  }

  svg.appendChild(el('circle', {cx, cy, r:20, fill:'#1e3a5f', stroke:'#2d5a8e', 'stroke-width':'1.5'}));
  svg.appendChild(el('text', {x:cx, y:cy, 'text-anchor':'middle', 'dominant-baseline':'central', fill:'#f5c842', 'font-size':'18'}, '☉'));

  const placed = [];
  data.forEach((p, idx) => {
    if (!p) return;
    const angle = (p.lon - 90) * DEG;
    svg.appendChild(el('circle', {
      cx:cx+rI*Math.cos(angle), cy:cy+rI*Math.sin(angle),
      r:'3.5', fill:PLANETS[idx].color, stroke:'white', 'stroke-width':'1.2'
    }));
    svg.appendChild(el('line', {
      x1:cx+(rI-4)*Math.cos(angle), y1:cy+(rI-4)*Math.sin(angle),
      x2:cx+(rP+13)*Math.cos(angle), y2:cy+(rP+13)*Math.sin(angle),
      stroke:PLANETS[idx].color+'70', 'stroke-width':'0.8', 'stroke-dasharray':'2.5 2'
    }));
    let pa = angle;
    placed.forEach(q => { if (Math.abs(q-pa) < 0.25) pa += 0.25; });
    placed.push(pa);
    svg.appendChild(el('text', {
      x:cx+rP*Math.cos(pa), y:cy+rP*Math.sin(pa),
      'text-anchor':'middle', 'dominant-baseline':'central',
      fill:PLANETS[idx].color, 'font-size':'15', 'font-weight':'bold'
    }, PLANETS[idx].symbol));
  });

  svg.appendChild(el('circle', {cx, cy, r:rO, fill:'none', stroke:'#8898c0', 'stroke-width':'1.5'}));
}

// ── RENDER LIST ────────────────────────────────────────────────────────────
function renderList(data) {
  const c = document.getElementById('planet-list');
  c.innerHTML = '';
  data.forEach((p, i) => {
    if (!p) return;
    const sign   = getSign(p.lon);
    const minStr = String(sign.min).padStart(2, '0');
    const row    = document.createElement('div');
    row.className = 'planet-row';
    row.style.animationDelay = (i * 0.06) + 's';
    row.innerHTML = `
      <span class="planet-symbol" style="color:${PLANETS[i].color}">${PLANETS[i].symbol}</span>
      <span class="planet-name">${PLANETS[i].name}</span>
      <div class="planet-position">
        <span class="sign-symbol" style="color:${sign.color}">${sign.symbol}</span>
        <span class="sign-name">${sign.name}</span>
        ${p.retrograde ? '<span class="retrograde">Rx</span>' : ''}
      </div>
      <span class="degrees">${sign.deg}°${minStr}'</span>
    `;
    c.appendChild(row);
  });
}

// ── MAIN — initialise Swiss Ephemeris then calculate ───────────────────────
async function init() {
  const now = new Date();

  // Update date display
  document.getElementById('current-date').textContent =
    now.toLocaleDateString('pl-PL', {
      weekday:'long', year:'numeric', month:'long', day:'numeric',
      hour:'2-digit', minute:'2-digit', timeZone:'UTC'
    }) + ' UTC';

  try {
    // Load Swiss Ephemeris WASM
    const swe = await SwissEph.init();

    // Julian Day (UT)
    const jd = swe.swe_julday(
      now.getUTCFullYear(),
      now.getUTCMonth() + 1,
      now.getUTCDate(),
      now.getUTCHours() + now.getUTCMinutes() / 60 + now.getUTCSeconds() / 3600,
      1 // SE_GREG_CAL
    );

    // SEFLG_SPEED (256) — gives longitude + speed (speed used for retrograde)
    const FLAG = 256;

    const data = PLANETS.map(p => {
      try {
        const result = swe.swe_calc_ut(jd, p.id, FLAG);
        // result[0] = ecliptic longitude, result[3] = daily motion (negative = retrograde)
        const lon = ((result[0] % 360) + 360) % 360;
        const retrograde = result[3] < 0;
        return { lon, retrograde };
      } catch(e) {
        return null;
      }
    });

    renderList(data);
    drawWheel(data);

    // Update every 10 minutes
    setInterval(async () => {
      const n = new Date();
      const jd2 = swe.swe_julday(
        n.getUTCFullYear(), n.getUTCMonth()+1, n.getUTCDate(),
        n.getUTCHours() + n.getUTCMinutes()/60 + n.getUTCSeconds()/3600, 1
      );
      document.getElementById('current-date').textContent =
        n.toLocaleDateString('pl-PL', {weekday:'long',year:'numeric',month:'long',day:'numeric',hour:'2-digit',minute:'2-digit',timeZone:'UTC'}) + ' UTC';
      const d2 = PLANETS.map(p => {
        try {
          const r = swe.swe_calc_ut(jd2, p.id, FLAG);
          return { lon: ((r[0]%360)+360)%360, retrograde: r[3] < 0 };
        } catch { return null; }
      });
      renderList(d2); drawWheel(d2);
    }, 600000);

  } catch (err) {
    document.getElementById('planet-list').innerHTML =
      `<div class="status error">⚠ Błąd ładowania Swiss Ephemeris:<br><small>${err.message}</small></div>`;
  }
}

init();
</script>
</body>
</html>
